{% extends 'base.html.twig' %}
{% block title %}Paiement{% endblock %}

{% block body %}
<div class="container py-5">
    <h2>Paiement du Dossier Fiscal - Année {{ dossier_fiscale.anneeFiscale }}</h2>
    <p>Montant à payer : <strong>{{ dossier_fiscale.totalImpot - dossier_fiscale.totalImpotPaye }} TND</strong></p>

    <button id="checkout-button" class="btn btn-success">Procéder au Paiement</button>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe('{{ stripe_public_key }}');

    document.getElementById('checkout-button').addEventListener('click', function () {
        fetch('{{ path('create_checkout_session', {'token': dossier_fiscale.token}) }}', {
            method: 'POST',
        })
        .then(response => response.json())
        .then(session => {
            return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .catch(error => console.error('Error:', error));
    });
</script>
{% endblock %}
