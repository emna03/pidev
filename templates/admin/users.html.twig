{% extends 'base_admin.html.twig' %}

{% block title %}Gestion des utilisateurs{% endblock %}

{% block stylesheet %}
    {{ parent() }}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f5f7fa;
            font-family: 'Roboto', sans-serif;
        }

        .admin-card {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .admin-card-header {
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            border-bottom: 1px solid #ddd;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid #ccc;
        }

        .table thead th {
            background-color: #f1f3f5;
            font-weight: bold;
            text-align: center;
        }

        .table td, .table th {
            vertical-align: middle;
            text-align: center;
        }

        .table-actions a {
            margin: 0 0.3rem;
            color: #333;
            transition: transform 0.2s ease-in-out;
        }

        .table-actions a:hover {
            transform: scale(1.2);
        }

        .badge {
            font-size: 0.85rem;
            padding: 0.5em 0.7em;
        }

        #searchForm {
            margin-top: 1rem;
        }

        #searchForm input.form-control {
            border-radius: 30px;
            padding: 0.6rem 1rem;
        }

        #searchForm .input-group-text {
            border-radius: 30px 0 0 30px;
            background-color: #fff;
            border-right: none;
        }

        #searchInput {
            border-left: none;
        }
    </style>
{% endblock %}

{% block body %}
<div class="container my-5">
  <div class="card admin-card">
    <div class="admin-card-header">
      <h2 class="mb-0">ðŸ‘¥ Gestion des utilisateurs</h2>
      
    </div>

    <div class="card-body">
      <form method="get" id="searchForm" class="d-flex justify-content-start align-items-center mb-4 px-2">
        <div class="input-group w-50">
          <span class="input-group-text">
            <i class="fas fa-search text-muted"></i>
          </span>
          <input type="text" name="search" id="searchInput" class="form-control shadow-sm"
                 placeholder="Rechercher un nom, prÃ©nom ou email..." value="{{ search ?? '' }}">
        </div>
       
      </form>

      {% for message in app.flashes('success') %}
        <div class="alert alert-success">{{ message }}</div>
      {% endfor %}
           <a href="{{ path('admin_users_pdf', { search: app.request.get('search') }) }}"
         class="btn btn-danger mb-3"
         target="_blank">
         <i class="fas fa-file-pdf"></i> Exporter PDF
      </a>
      <div class="table-responsive">
        <table class="table table-hover table-bordered align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Photo</th>
              <th>Nom complet</th>
              <th>Email</th>
              <th>RÃ´le</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
              <tr>
                <td>{{ user.id }}</td>
                <td>
                  {% if user.photoProfil %}
                    <img src="{{ asset('uploads/' ~ user.photoProfil) }}" alt="Photo" class="user-avatar">
                  {% else %}
                    <span class="text-muted">â€”</span>
                  {% endif %}
                </td>
                <td>{{ user.nom }} {{ user.prenom }}</td>
                <td>{{ user.email }}</td>
                <td><span class="badge bg-primary">{{ user.role }}</span></td>
                <td>
                  {% if user.activer %}
                    <span class="badge bg-success">ActivÃ©</span>
                  {% else %}
                    <span class="badge bg-secondary">DÃ©sactivÃ©</span>
                  {% endif %}
                </td>
                <td class="table-actions">
                  {% if user.activer %}
                    <a href="{{ path('admin_user_deactivate', {'id': user.id}) }}" title="DÃ©sactiver">
                      <i class="fas fa-ban text-warning"></i>
                    </a>
                  {% else %}
                    <a href="{{ path('admin_user_activate', {'id': user.id}) }}" title="Activer">
                      <i class="fas fa-check-circle text-success"></i>
                    </a>
                  {% endif %}
                  <a href="{{ path('admin_user_delete', {'id': user.id}) }}"
                     onclick="return confirm('Supprimer cet utilisateur ?')"
                     title="Supprimer">
                    <i class="fas fa-trash text-danger"></i>
                  </a>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="7" class="text-center text-muted">Aucun utilisateur trouvÃ©.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block javascript %}
    {{ parent() }}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
          const searchInput = document.getElementById('searchInput');
          const searchForm = document.getElementById('searchForm');

          let typingTimer;
          const delay = 400;

          searchInput.addEventListener('input', function () {
            clearTimeout(typingTimer);
            typingTimer = setTimeout(() => {
              searchForm.submit();
            }, delay);
          });
        });
    </script>
{% endblock %}
